# 認証機能セットアップガイド

## 概要

このアプリケーションは AWS Cognito を使用した認証システムを実装しています。

## セットアップ手順

### 1. インフラストラクチャのデプロイ

```bash
# バックエンドディレクトリに移動
cd backend/infrastructure

# 開発環境にデプロイ
./deploy.sh dev
```

### 2. 環境変数の設定

デプロイ完了後、自動生成される `frontend/.env.local` ファイルを確認してください。

手動で設定する場合は、`.env.local.example` をコピーして値を設定：

```bash
# フロントエンドディレクトリで
cp .env.local.example .env.local
```

### 3. 依存関係のインストール

```bash
# フロントエンドディレクトリで
npm install
```

### 4. 開発サーバーの起動

```bash
# フロントエンドディレクトリで
npm run dev
```

## 認証フロー

### 1. 初回アクセス

- ルートページ (`/`) にアクセス
- 未認証の場合、自動的にログインページ (`/login`) にリダイレクト

### 2. 新規登録

- ログインページから「新規登録」リンクをクリック
- `/register` ページで必要情報を入力
- 登録後、メール確認ページ (`/auth/confirm-email`) にリダイレクト
- メールに送信された確認コードを入力

### 3. ログイン

- `/login` ページでメールアドレスとパスワードを入力
- 認証成功後、ダッシュボード (`/dashboard`) にリダイレクト

### 4. パスワードリセット

- ログインページから「パスワードを忘れた方はこちら」をクリック
- `/auth/forgot-password` でメールアドレスを入力
- メールに送信されたコードで新しいパスワードを設定

## 認証状態の管理

### 自動リダイレクト

- **未認証ユーザー**: 保護されたページにアクセスすると `/login` にリダイレクト
- **認証済みユーザー**: ログインページにアクセスすると `/dashboard` にリダイレクト
- **ルートページ**: 認証状態に応じて適切なページにリダイレクト

### 保護されたページ

- `/dashboard`: 認証必須
- その他の学習コンテンツページ（今後実装予定）

### 公開ページ

- `/login`: ログインページ
- `/register`: 新規登録ページ
- `/auth/*`: 認証関連ページ

## トラブルシューティング

### 環境変数が未設定の場合

- コンソールに警告メッセージが表示されます
- 認証機能は無効化され、常に未認証状態として扱われます
- ログインを試行すると設定エラーメッセージが表示されます

### よくある問題

1. **ログインできない**

   - Cognito ユーザープールが正しくデプロイされているか確認
   - 環境変数が正しく設定されているか確認
   - ユーザーがメール確認を完了しているか確認

2. **リダイレクトループ**

   - ブラウザのローカルストレージをクリア
   - 認証状態をリセット

3. **メール確認コードが届かない**
   - スパムフォルダを確認
   - 確認コードの再送信を試行

## 開発時の注意事項

- 環境変数が未設定でも開発は可能ですが、認証機能は動作しません
- 本番環境では必ず適切な環境変数を設定してください
- 認証状態はローカルストレージに保存されます（開発時のみ）
